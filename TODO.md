# TODO: Cache Library ‚Äî –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –¥–æ—Ä–∞–±–æ—Ç–æ–∫

## –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

**–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è:** MVP + Extensions (LRU, LFU, TTL, ThreadSafeCache, ShardedCache, Persistence, Sync / Async Listeners)
**–¢–µ—Å—Ç—ã:** –ø–æ–∫—Ä—ã–≤–∞—é—Ç eviction, TTL, listeners, persistence, concurrency
**–ë–µ–Ω—á–º–∞—Ä–∫–∏:** –≤—ã–ø–æ–ª–Ω–µ–Ω—ã (LRU vs LFU, listeners sync vs async, concurrency)

---

## üî¥ MUST DO (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ)

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ persistence

**–ü—Ä–æ–±–ª–µ–º–∞:**
Persistence —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ —Å—Ç–æ—Ä–æ–Ω—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫—ç—à–∞. –ú–µ—Ö–∞–Ω–∏–∑–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –Ω–µ—Ç.

**–í–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**

```cpp
// –í–∞—Ä–∏–∞–Ω—Ç A: –Ø–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ persistence
SnapshotPersistence<K, V> persistence("cache.bin");
persistence.loadInto(cache);
```

```cpp
// –í–∞—Ä–∏–∞–Ω—Ç B: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞–∫ —á–∞—Å—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
CacheBuilder<K, V>()
    .withCapacity(1000)
    .withEvictionPolicy<LRUPolicy>()
    .withPersistence("cache.bin")
    .loadOnStartup()
    .build();
```

```cpp
// –í–∞—Ä–∏–∞–Ω—Ç C: –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
cache.loadFromSnapshot("cache.bin");
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –≤–∞—Ä–∏–∞–Ω—Ç A ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ —Ç–æ—Ç –∂–µ –æ–±—ä–µ–∫—Ç persistence, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ.

**–ó–∞—Ç—Ä–∞–≥–∏–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã:**

* `include/cache/persistence/SnapshotPersistence.hpp`
* `include/cache/Cache.hpp`

---

### 2. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ C++ cache –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏

**–¶–µ–ª—å:** –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –º–µ—Å—Ç–æ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ä–µ–¥–∏ —Ä–µ–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ä–µ—à–µ–Ω–∏–π.

**–ö–∞–Ω–¥–∏–¥–∞—Ç—ã –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (—Ä–µ–∞–ª—å–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ):**

1. **facebook/CacheLib**

   * –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π in-memory cache
   * —Å–ª–æ–∂–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –Ω–µ header-only

2. **tsl::lru_cache**

   * –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π header-only LRU
   * –±–µ–∑ concurrency, TTL, listeners

3. **gkiryaziev/lru_cache**

   * –ø—Ä–æ—Å—Ç–æ–π LRU –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
   * –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:**

| –ö—Ä–∏—Ç–µ—Ä–∏–π            | –¢–µ–∫—É—â–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ | CacheLib       | tsl::lru_cache | gkiryaziev/lru_cache |
| ------------------- | ------------------ | -------------- | -------------- | -------------------- |
| –ü–æ–ª–∏—Ç–∏–∫–∏ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è | LRU, LFU           | LRU, LFU, FIFO | LRU            | LRU                  |
| TTL                 | Global, PerKey     | –î–∞             | –ù–µ—Ç            | –ù–µ—Ç                  |
| Thread-safety       | Wrapper / Sharded  | –î–∞             | –ù–µ—Ç            | –ù–µ—Ç                  |
| Listeners / Hooks   | –î–∞                 | –î–∞             | –ù–µ—Ç            | –ù–µ—Ç                  |
| Async listeners     | –î–∞                 | –î–∞             | –ù–µ—Ç            | –ù–µ—Ç                  |
| Persistence         | Snapshot           | –î–∞             | –ù–µ—Ç            | –ù–µ—Ç                  |
| Header-only         | –î–∞                 | –ù–µ—Ç            | –î–∞             | –î–∞                   |

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

* –¥–æ–∫—É–º–µ–Ω—Ç `docs/COMPARISON.md`
* —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–¥ –∏ –±–µ–Ω—á–º–∞—Ä–∫–∏

---

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Prometheus

**–¶–µ–ª—å:** —ç–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ –∫—ç—à–∞ –¥–ª—è production-–Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç–∏.

**–ú–µ—Ç—Ä–∏–∫–∏:**

```
cache_hits_total
cache_misses_total
cache_hit_rate
cache_evictions_total
cache_size
cache_capacity
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** listener –ø–æ–≤–µ—Ä—Ö `ICacheListener`.

```cpp
template<typename K, typename V>
class PrometheusListener : public ICacheListener<K, V> {
    // counters / gauges
};
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:** `prometheus-cpp`

---

## üü° SHOULD DO (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ)

### 4. CacheBuilder

**–°—Ç–∞—Ç—É—Å:** –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω —á–∞—Å—Ç–∏—á–Ω–æ, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.

```cpp
auto cache = CacheBuilder<std::string, UserData>()
    .withCapacity(10000)
    .withEvictionPolicy<LFUPolicy>()
    .withTTL(std::chrono::minutes(30))
    .withPersistence("./cache.bin")
    .threadSafe()
    .addListener(statsListener)          // sync
    .addAsyncListener(persistenceListener)
    .build();
```

**–û—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã:**

* –æ–¥–∏–Ω `addListener` –∏–ª–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ sync / async
* –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª listeners

---

### 5. –£–ª—É—á—à–µ–Ω–∏–µ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤ persistence

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**

* –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–º–∏—Ç–∞—Ü–∏—è –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ listener

**–ù—É–∂–Ω–æ:**

* –±–µ–Ω—á–º–∞—Ä–∫–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º `PersistenceListener`
* –∑–∞–ø–∏—Å—å –Ω–∞ –¥–∏—Å–∫

---

## üü¢ COULD DO (–ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –≤—Ä–µ–º–µ–Ω–∏)

### 6. ARC (Adaptive Replacement Cache)

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞, –±–∞–ª–∞–Ω—Å–∏—Ä—É—é—â–∞—è –º–µ–∂–¥—É LRU –∏ LFU –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç workload.

**–°—Ç—Ä—É–∫—Ç—É—Ä—ã:**

* T1 / T2 ‚Äî —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏
* B1 / B2 ‚Äî ghost entries
* p ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä –∞–¥–∞–ø—Ç–∞—Ü–∏–∏

**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** 10‚Äì12 —á–∞—Å–æ–≤

---

### 7. WAL Persistence

**Write-Ahead Log** –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –º–µ–∂–¥—É snapshot.

**–ü–ª—é—Å—ã:**

* –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö
* –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å

---

## ‚ùå REJECTED (–û—Å–æ–∑–Ω–∞–Ω–Ω–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ)

### JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è

**–ü—Ä–∏—á–∏–Ω—ã –æ—Ç–∫–∞–∑–∞:**

* –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
* –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å
* –º–µ–¥–ª–µ–Ω–Ω–µ–µ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** CSV —ç–∫—Å–ø–æ—Ä—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

## üìå –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã

| # | –ó–∞–¥–∞—á–∞                 | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –û—Ü–µ–Ω–∫–∞ (—á) |
| - | ---------------------- | --------- | ---------- |
| 1 | Data loading           | üî¥ Must   | 3‚Äì4        |
| 2 | Library comparison     | üî¥ Must   | 4‚Äì6        |
| 3 | Prometheus             | üî¥ Must   | 4‚Äì5        |
| 4 | CacheBuilder           | üü° Should | 3‚Äì4        |
| 5 | Persistence benchmarks | üü° Should | 2‚Äì3        |
| 6 | ARC                    | üü¢ Could  | 10‚Äì12      |
| 7 | WAL                    | üü¢ Could  | 6‚Äì8        |

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-12-22*
